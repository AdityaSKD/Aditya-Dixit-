<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog vs. Cat Classifier</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        #prediction-container {
            font-weight: bold;
        }
        canvas {
            max-width: 400px;
            max-height: 300px;
            border: 1px solid #ccc;
        }
        video {
            max-width: 400px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>Dog vs. Cat Classifier</h1>
    <p>Select an image or use your webcam to see if it's a dog or a cat!</p>

    <div>
        <input type="file" id="image-upload" accept="image/*">
    </div>

    <div>
        <button id="webcam-button">Enable Webcam</button>
        <video id="webcam-view" autoplay playsinline style="display: none;"></video>
    </div>

    <canvas id="image-canvas" style="display: none;"></canvas>
    <p>Prediction: <span id="prediction-container"></span></p>

    <script>
        // Paste your Teachable Machine model loading and prediction script here
        // It will likely include functions like:
        // - loading the model
        // - handling image uploads
        // - accessing the webcam
        // - making predictions
        // - updating the prediction-container element
    </script>

    <script>
        const imageUpload = document.getElementById('image-upload');
        const webcamButton = document.getElementById('webcam-button');
        const webcamView = document.getElementById('webcam-view');
        const imageCanvas = document.getElementById('image-canvas');
        const predictionContainer = document.getElementById('prediction-container');
        const canvasContext = imageCanvas.getContext('2d');
        let model;

        async function loadModel() {
            // This function will be populated by your Teachable Machine script
            // Example (replace with your actual code):
            // const modelURL = 'YOUR_MODEL_URL/model.json';
            // const metadataURL = 'YOUR_MODEL_URL/metadata.json';
            // model = await tmImage.load(modelURL, metadataURL);
        }

        async function predictImage() {
            if (model && imageCanvas.style.display !== 'none') {
                const prediction = await model.predict(imageCanvas);
                // Sort predictions by probability
                prediction.sort((a, b) => b.probability - a.probability);
                predictionContainer.innerText = ${prediction[0].className} (Confidence: ${(prediction[0].probability * 100).toFixed(2)}%);
            } else {
                predictionContainer.innerText = 'No image selected or model not loaded.';
            }
        }

        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        imageCanvas.width = img.width;
                        imageCanvas.height = img.height;
                        canvasContext.drawImage(img, 0, 0, img.width, img.height);
                        imageCanvas.style.display = 'block';
                        webcamView.style.display = 'none';
                        predictImage();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                imageCanvas.style.display = 'none';
                predictionContainer.innerText = '';
            }
        });

        let streaming = false;
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(function(stream) {
                webcamView.srcObject = stream;
                webcamView.play();
                streaming = true;
            })
            .catch(function(err) {
                console.error("An error occurred: " + err);
                webcamButton.disabled = true;
            });

        webcamView.addEventListener('loadedmetadata', function(){
            imageCanvas.width = webcamView.videoWidth;
            imageCanvas.height = webcamView.videoHeight;
        }, false);

        webcamButton.addEventListener('click', () => {
            if (streaming) {
                imageCanvas.width = webcamView.videoWidth;
                imageCanvas.height = webcamView.videoHeight;
                canvasContext.drawImage(webcamView, 0, 0, webcamView.videoWidth, webcamView.videoHeight);
                imageCanvas.style.display = 'block';
                webcamView.style.display = 'block';
                predictImage();
            }
        });

        // Call the model loading function (will be completed by your Teachable Machine script)
        loadModel();
    </script>
</body>
</html>
